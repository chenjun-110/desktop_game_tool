<!DOCTYPE html>
<html ng-app="gameTool">
<head>
    <title>用户自定义</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" type="text/css" href="../js/framework/bootstrap/3.0.2/bootstrap.min.css">

</head>
<body ng-controller="gameInitCtrl">
<nav class="navbar navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <a class="navbar-brand" href="#">{{gameConfig.name}}</a>
      <a  class="btn btn-default navbar-btn pull-right" ng-href="introduceGame.html?gameid={{gameConfig.gameid}}">
            版本介绍
        </a>
    </div>
</nav>
<!--
 item1
    role [    ]
    card [    ]
 item2
    role [    ]
    card [    ]
-->
<div class="roleChooser container" >
    <form class="form-horizontal" role="form" name="roleChooserForm">
        <div class="form-group ">
                <label for="maxPeople" class="col-xs-4 control-label">总人数</label>
                <div class="col-xs-offset-2 col-xs-3">

                    <select  ng-model='peopleNum' ng-options="num for num in gameConfig.peopleNumList">

                    </select>
                    <input id="hidPeopleNum" type="hidden" value="{{peopleNum}}">
                    <input  type="hidden" required="required" class="form-control" name='maxPeople' onselect="{{gameChange(peopleNum)}}"  min="0" max="100" placeholder="人数" value="{{gameConfig.playerNumDefault}}">
                </div>
                <span class="error" id="maxPeople" style="visibility: hidden">
                    error
                </span>

        </div>
        <div class="form-group roleDiv"  ng-repeat="role in gameConfig.roles">
            <p class="roleName">{{role.CN}}</p>
            <div ng-repeat="properties in gameConfig.showProperties">

                    <label ng-show="properties.name == 'role' " class="col-xs-4 control-label">人数</label>
                    <div class="col-xs-offset-2 col-xs-3" ng-show="properties.name == 'role' ">
                        <input type="number" name="{{role.name}}" ng-show="properties.name == 'role' " class="form-control roleItem roleNum" min="0" max="100" value="{{role.num}}" />
                    </div>
                     <span id="{{role.name}}" class="error" style="visibility: hidden" ng-if="properties.name == 'role' ">
                        error
                    </span>

                <div ng-show="properties.name != 'role' ">
                    <label  class="col-xs-4 control-label">{{properties.CN}}</label>
                    <div class="col-xs-offset-2 col-xs-3">
                        <input type="text" name="{{role.name}}<-->{{properties.name}}" class="form-control" value="{{gameConfig.properties[properties.name][role.name]}}"/>
                    </div>
                </div>

            </div>
        </div>
    </form>
</div>
<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
    <div class="navbar-header">
        <a class="btn btn-danger pull-left navbar-btn" href="list.html" ng-click="gameExit()">返回列表</a>
        <a style='display: none' id='startButton'   ng-href="gamePlay.html?gameid={{gameConfig.gameid}}" ng-click="gameInit()">开始</a>
        <a id="fakeButton" class="btn btn-primary pull-right navbar-btn" onclick="checkForm()">开始</a>
        <!-- "-->
    </div>
</nav>
<script type="text/javascript" src="../js/framework/jquery/2.0.0/jquery.min.js"></script>
<script src="../js/framework/angular/angular.js"></script>
<script src="../js/framework/bootstrap/3.0.2/bootstrap.min.js"></script>
<script src="../js/framework/box/bootbox.min.js"></script>
<script src="../js/game/config.js"></script>
<script src="../js/util/common_util.js"></script>
<script src="../js/game/game.js"></script>
<script>
    /*function checkRoleNum(role){
        var reg=new RegExp(/^\d{1,2}$/);
        var obj=document.getElementById(role.name);
        var num=parseInt(role.value);
        if(role){
            if(num >= role.min && num <= role.max && reg.test(role.value) ){
                obj.style.visibility = 'hidden';
                var items = document.getElementsByClassName("roleItem");
                var max = document.getElementById("hidPeopleNum");
                var maxError=document.getElementById("maxPeople");
                var sum=0;
                if(role.name!="maxPeople"){
                    for(var i=0;i<items.length;i++){
                        if(items[i].style.display=='none')continue;
                        sum=sum+parseInt(items[i].value);
                    }
                    console.log(sum);
                    console.log(max.value);
                   if(sum!=max.value){
                       maxError.style.visibility='visible';
                   }else{
                       maxError.style.visibility='hidden';
                   }
                }

            }else{
                obj.style.visibility ='visible';
            }
            checkStartBtn();
        }
    }

        function checkStartBtn(){
            var errorObj=document.getElementsByClassName("error");
            var startBtn = document.getElementById("startButton");
            for(var i=0;i<errorObj.length;i++){
                if(errorObj[i].style.visibility != "hidden" ){
                    domUtil.addClass(startBtn,"disabled");
                    break;
                }
                domUtil.removeClass(startBtn,"disabled");
            }
        }
    */
    function checkForm(){
       var items = document.getElementsByClassName("roleItem"),
           sum   = 0,
           max   = document.getElementById("hidPeopleNum"),
           gameid = getParameterFromUrl(location.href, "gameid"),
           hidBtn = document.getElementById("startButton");


        // btn   = document.getElementById('startButton');

        for(var i= 0,ii=items.length;i<ii;i++){
           if(items[i].style.display=='none')continue;
           sum=sum+parseInt(items[i].value);
       }

        if(sum!=max.value||!isReq()){
           console.log(isReq());
            bootbox.alert("请检查输入的数据或者游戏数据不完整！");

        }else{
            hidBtn.click();
        }
    }
    function isReq(){
        var items = document.getElementsByTagName("input");
        for(var i=0;i<items.length;i++){
            if(items[i].style.display!="none"&&items[i].style.visibility!="hidden"&&items[i].type!='hidden'){
                console.log(items[i]);
                if(!items[i].value) return false;
            }
        }
        return true;
    }

</script>
</body>
</html>